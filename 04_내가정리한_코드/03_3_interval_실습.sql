/******************************************************
날짜와 시간 연산. INTERVAL의 활용.
*******************************************************/

-- 날짜 연산
-- DATE 타입에 숫자값을 더하거나/빼면 숫자값에 해당하는 일자를 더해거나/빼서 날짜 계산.
SELECT TO_DATE('2022-01-01', 'YYYY-MM-DD') +  2 AS DATE_01;

-- DATE 타입에 곱하기나 나누기는 할 수 없음.
SELECT TO_DATE('2022-01-01', 'YYYY-MM-DD') * 10 AS DATE_01;

-- TIMESTAMP 연산. +7을 하면 아래는 오류를 발생.
SELECT TO_TIMESTAMP('2022-01-01 14:36:52', 'YYYY-MM-DD HH24:MI:SS') + 7;

-- TIMESTAMP는 INTERVAL 타입을 이용하여 연산 수행.
SELECT TO_TIMESTAMP('2022-01-01 14:36:52', 'YYYY-MM-DD HH24:MI:SS') + INTERVAL '7 HOUR' AS TIMESTAMP_01;

SELECT TO_TIMESTAMP('2022-01-01 14:36:52', 'YYYY-MM-DD HH24:MI:SS') + INTERVAL '2 DAYS' AS TIMESTAMP_01;

SELECT TO_TIMESTAMP('2022-01-01 14:36:52', 'YYYY-MM-DD HH24:MI:SS') + INTERVAL '2 DAYS 7 HOURS 30 MINUTES' AS TIMESTAMP_01;

-- DATE 타입에 INTERVAL을 더하면 TIMESTAMP로 변환됨.
SELECT TO_DATE('2022-01-01', 'YYYY-MM-DD') + INTERVAL '2 DAYS' AS DATE_01;

-- INTERVAL '2 DAYS'와 같이 ' '내에는 DAYS나 DAY를 혼용해도 되지만 INTERVAL '2' DAY만 허용.
SELECT TO_DATE('2022-01-01', 'YYYY-MM-DD') + INTERVAL '2' DAY AS DATE_01;

-- 날짜 간의 차이 구하기. 차이값은 정수형.
SELECT TO_DATE('2022-01-03', 'YYYY-MM-DD') - TO_DATE('2022-01-01', 'YYYY-MM-DD') AS INTERVAL_01
     , PG_TYPEOF(TO_DATE('2022-01-03', 'YYYY-MM-DD') - TO_DATE('2022-01-01', 'YYYY-MM-DD')) AS TYPE ;

-- TIMESTAMP간의 차이 구하기. 차이값은 INTERVAL
SELECT TO_TIMESTAMP('2022-01-01 14:36:52', 'YYYY-MM-DD HH24:MI:SS')
    - TO_TIMESTAMP('2022-01-01 12:36:52', 'YYYY-MM-DD HH24:MI:SS') AS TIME_01
     , PG_TYPEOF(TO_TIMESTAMP('2022-01-01 08:36:52', 'YYYY-MM-DD HH24:MI:SS')
    - TO_TIMESTAMP('2022-01-01 12:36:52', 'YYYY-MM-DD HH24:MI:SS')) AS TYPE
;

-- DATE + DATE는 허용하지 않음.
SELECT TO_DATE('2022-01-03', 'YYYY-MM-DD') +  TO_DATE('2022-01-01', 'YYYY-MM-DD')

-- NOW(), CURRENT_TIMESTAMP, CURRENT_DATE, CURRENT_TIME
-- INTERVAL을 년, 월, 일로 표시하기. JUSTIFY_INTERVAL와 AGE 사용 차이
    WITH
TEMP_01 AS (
SELECT EMPNO, ENAME, HIREDATE, NOW(), CURRENT_TIMESTAMP, CURRENT_DATE, CURRENT_TIME
	, DATE_TRUNC('SECOND', NOW()) AS NOW_TRUNC
	, NOW() - HIREDATE AS 근속기간
FROM HR.EMP
)
SELECT *
     , DATE_PART('YEAR', 근속기간)
     , JUSTIFY_INTERVAL(근속기간) -- 43 years 7 mons 15 days 9 hours 3 mins 37.040751 secs
     , AGE(HIREDATE)
     , DATE_PART('YEAR', JUSTIFY_INTERVAL(근속기간))||'년 '||DATE_PART('MONTH', JUSTIFY_INTERVAL(근속기간))||'월' AS 근속년월
     , DATE_PART('YEAR', AGE(HIREDATE))||'년 '||DATE_PART('MONTH', AGE(HIREDATE))||'월' AS 근속년월_01
FROM TEMP_01;
